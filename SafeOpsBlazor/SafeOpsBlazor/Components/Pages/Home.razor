@page "/"
@using System.Security.Claims
@inject NavigationManager NavigationManager
@inject IStringLocalizer<Lang> localizer
@inject MaintenaceClientService maintenaceClientService
@inject ViolationClientService violationClientService
@inject TraineeClientService traineeClientService
@inject UserClientService userClientService

<SfSpinner Visible="isBusy" />

<AuthorizeView>
    <Authorized>

@*         Hello, @context?.User?.Identity?.Name!
        Your email is (@context?.User?.FindFirst(ClaimTypes.Email)?.Value?)
        Your data is (@context?.User?.FindFirst(ClaimTypes.UserData)?.Value?) *@


        <div class="container" style="margin-top: 32px;">
            <div class="row">
                <div class="col">
                    <h1 class="text-uppercase text-center text-bg-dark p-5">@localizer["Statistics"]</h1>
                </div>
            </div>
            <hr />
            <div class="row" style="margin-top: 36px;">
                <div class="col">
                    <div class="text-bg-dark" style="width: 100%;height: 100%;">
                        <div class="text-center d-flex flex-column justify-content-center align-items-center py-3">
                            <div class="bs-icon-xl bs-icon-circle bs-icon-primary d-flex flex-shrink-0 justify-content-center align-items-center d-inline-block mb-2 bs-icon lg">
                                <svg class="bi bi-exclamation-triangle-fill" xmlns="http://www.w3.org/2000/svg" width="1em" height="1em" fill="currentColor" viewBox="0 0 16 16">
                                    <path d="M8.982 1.566a1.13 1.13 0 0 0-1.96 0L.165 13.233c-.457.778.091 1.767.98 1.767h13.713c.889 0 1.438-.99.98-1.767L8.982 1.566zM8 5c.535 0 .954.462.9.995l-.35 3.507a.552.552 0 0 1-1.1 0L7.1 5.995A.905.905 0 0 1 8 5m.002 6a1 1 0 1 1 0 2 1 1 0 0 1 0-2"></path>
                                </svg>
                            </div>
                            <div class="px-3">
                                <h2 class="fw-bold mb-0">@violationsCount</h2>
                                <p class="mb-0">@localizer["Violations"]</p>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="col">
                    <div class="text-bg-dark" style="width: 100%;height: 100%;">
                        <div class="text-center d-flex flex-column justify-content-center align-items-center py-3">
                            <div class="bs-icon-xl bs-icon-circle bs-icon-primary d-flex flex-shrink-0 justify-content-center align-items-center d-inline-block mb-2 bs-icon lg">
                                <svg class="bi bi-person-arms-up" xmlns="http://www.w3.org/2000/svg" width="1em" height="1em" fill="currentColor" viewBox="0 0 16 16">
                                    <path d="M8 3a1.5 1.5 0 1 0 0-3 1.5 1.5 0 0 0 0 3"></path>
                                    <path d="m5.93 6.704-.846 8.451a.768.768 0 0 0 1.523.203l.81-4.865a.59.59 0 0 1 1.165 0l.81 4.865a.768.768 0 0 0 1.523-.203l-.845-8.451A1.492 1.492 0 0 1 10.5 5.5L13 2.284a.796.796 0 0 0-1.239-.998L9.634 3.84a.72.72 0 0 1-.33.235c-.23.074-.665.176-1.304.176-.64 0-1.074-.102-1.305-.176a.72.72 0 0 1-.329-.235L4.239 1.286a.796.796 0 0 0-1.24.998l2.5 3.216c.317.316.475.758.43 1.204Z"></path>
                                </svg>
                            </div>
                            <div class="px-3">
                                <h2 class="fw-bold mb-0">@traineesCount</h2>
                                <p class="mb-0">@localizer["Trainees"]</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>


            <div class="row" style="margin-top: 36px;">

                <div class="col">
                    <div class="text-bg-dark" style="width: 100%;height: 100%;">
                        <div class="text-center d-flex flex-column justify-content-center align-items-center py-3">
                            <div class="bs-icon-xl bs-icon-circle bs-icon-primary d-flex flex-shrink-0 justify-content-center align-items-center d-inline-block mb-2 bs-icon lg">
                                <svg class="bi bi-person-lines-fill" xmlns="http://www.w3.org/2000/svg" width="1em" height="1em" fill="currentColor" viewBox="0 0 16 16">
                                    <path d="M6 8a3 3 0 1 0 0-6 3 3 0 0 0 0 6m-5 6s-1 0-1-1 1-4 6-4 6 3 6 4-1 1-1 1zM11 3.5a.5.5 0 0 1 .5-.5h4a.5.5 0 0 1 0 1h-4a.5.5 0 0 1-.5-.5m.5 2.5a.5.5 0 0 0 0 1h4a.5.5 0 0 0 0-1zm2 3a.5.5 0 0 0 0 1h2a.5.5 0 0 0 0-1zm0 3a.5.5 0 0 0 0 1h2a.5.5 0 0 0 0-1z"></path>
                                </svg>
                            </div>
                            <div class="px-3">
                                <h2 class="fw-bold mb-0">@usersCount.ToString()</h2>
                                <p class="mb-0">@localizer["Users"]</p>
                            </div>
                        </div>
                    </div>
                </div>


                <div class="col">
                    <div class="text-bg-dark" style="width: 100%;height: 100%;">
                        <div class="text-center d-flex flex-column justify-content-center align-items-center py-3">
                            <div class="bs-icon-xl bs-icon-circle bs-icon-primary d-flex flex-shrink-0 justify-content-center align-items-center d-inline-block mb-2 bs-icon lg">
                                <svg class="bi bi-arrow-right-square-fill" xmlns="http://www.w3.org/2000/svg" width="1em" height="1em" fill="currentColor" viewBox="0 0 16 16">
                                    <path d="M0 14a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V2a2 2 0 0 0-2-2H2a2 2 0 0 0-2 2zm4.5-6.5h5.793L8.146 5.354a.5.5 0 1 1 .708-.708l3 3a.5.5 0 0 1 0 .708l-3 3a.5.5 0 0 1-.708-.708L10.293 8.5H4.5a.5.5 0 0 1 0-1"></path>
                                </svg>
                            </div>
                            <div class="px-3">
                                <h2 class="fw-bold mb-0">@forwardedViolationsCount.ToString()</h2>
                                <p class="mb-0">@localizer["ForwardedViolations"]</p>
                            </div>
                        </div>
                    </div>
                </div>

            </div>

            <div class="row" style="margin-top: 36px;">

                <div class="col">
                    <div class="text-bg-dark" style="width: 100%;height: 100%;">
                        <div class="text-center d-flex flex-column justify-content-center align-items-center py-3">
                            <div class="bs-icon-xl bs-icon-circle bs-icon-primary d-flex flex-shrink-0 justify-content-center align-items-center d-inline-block mb-2 bs-icon lg">
                                <svg class="bi bi-shield-fill-plus" xmlns="http://www.w3.org/2000/svg" width="1em" height="1em" fill="currentColor" viewBox="0 0 16 16">
                                    <path fill-rule="evenodd" d="M8 0c-.69 0-1.843.265-2.928.56-1.11.3-2.229.655-2.887.87a1.54 1.54 0 0 0-1.044 1.262c-.596 4.477.787 7.795 2.465 9.99a11.777 11.777 0 0 0 2.517 2.453c.386.273.744.482 1.048.625.28.132.581.24.829.24s.548-.108.829-.24a7.159 7.159 0 0 0 1.048-.625 11.775 11.775 0 0 0 2.517-2.453c1.678-2.195 3.061-5.513 2.465-9.99a1.541 1.541 0 0 0-1.044-1.263 62.467 62.467 0 0 0-2.887-.87C9.843.266 8.69 0 8 0m-.5 5a.5.5 0 0 1 1 0v1.5H10a.5.5 0 0 1 0 1H8.5V9a.5.5 0 0 1-1 0V7.5H6a.5.5 0 0 1 0-1h1.5z"></path>
                                </svg>
                            </div>
                            <div class="px-3">
                                <h2 class="fw-bold mb-0">@maintenanceOrdersCount.ToString()</h2>
                                <p class="mb-0">@localizer["MaintenanceOrders"]</p>
                            </div>
                        </div>
                    </div>
                </div>

            </div>
        </div>

        
    </Authorized>
    
    <NotAuthorized>
        @(NavToLogin());
    </NotAuthorized>
</AuthorizeView>



@code
{

    #region Fields

    int violationsCount = 0;
    int traineesCount = 0;
    int usersCount = 0;
    int forwardedViolationsCount = 0;
    int maintenanceOrdersCount = 0;


    //work
    bool isBusy;


    #endregion

    #region Events

    //on initialized
    protected override async Task OnInitializedAsync()
    {
        Task.Run(async () =>
        {
            isBusy = true;
            await InvokeAsync(StateHasChanged);
            await GetStatistics();
            isBusy = false;
            await InvokeAsync(StateHasChanged);
        });
    }

    #endregion

    #region Methods


    private object NavToLogin()
    {
        NavigationManager.NavigateTo("/login");

        return null;
    }

    //get statistics
    private async Task GetStatistics()
    {
        //get violations count
        violationsCount = await violationClientService.GetViolationsCountAsync();
        forwardedViolationsCount = await violationClientService.GetForwardedViolationsCountAsync();
        
        //get trainees count
        traineesCount = await traineeClientService.GetTraineesCountAsync();

        //get users count
        usersCount = await userClientService.GetUsersCount();

        //get maintenance orders count
        maintenanceOrdersCount = await maintenaceClientService.GetMaintenanceCount();
    }

    #endregion



   
}
